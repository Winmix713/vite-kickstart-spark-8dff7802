import { test, expect, type Page } from '@playwright/test' // Test data const TEST_USER = { email: 'test@example.com', password: 'password', role: 'user' } const ADMIN_USER = { email: 'admin@example.com', password: 'password', role: 'admin' } test.describe('WinMix E2E Authentication & Authorization', () => { test.beforeEach(async ({ page }) => { // Navigate to the application await page.goto('/') await page.waitForLoadState('networkidle') }) test.describe('User Authentication', () => { test('should allow user to sign in successfully', async ({ page }) => { // Navigate to login page await page.getByRole('button', { name: /sign in|login/i }).click() // Fill in credentials await page.getByLabel(/email/i).fill(TEST_USER.email) await page.getByLabel(/password/i).fill(TEST_USER.password) // Submit form await page.getByRole('button', { name: /sign in|login/i }).click() // Wait for successful login await page.waitForURL('**/dashboard', { timeout: 10000 }) // Verify user is logged in await expect(page.getByText(/welcome|hello/i)).toBeVisible() await expect(page.getByRole('button', { name: /sign out|logout/i })).toBeVisible() }) test('should show error for invalid credentials', async ({ page }) => { await page.getByRole('button', { name: /sign in|login/i }).click() await page.getByLabel(/email/i).fill('invalid@example.com') await page.getByLabel(/password/i).fill('wrongpassword') await page.getByRole('button', { name: /sign in|login/i }).click() // Verify error message is displayed await expect(page.getByText(/invalid credentials|login failed/i)).toBeVisible() }) test('should allow user to sign out', async ({ page }) => { // Sign in first await page.getByRole('button', { name: /sign in|login/i }).click() await page.getByLabel(/email/i).fill(TEST_USER.email) await page.getByLabel(/password/i).fill(TEST_USER.password) await page.getByRole('button', { name: /sign in|login/i }).click() await page.waitForURL('**/dashboard') // Sign out await page.getByRole('button', { name: /sign out|logout/i }).click() // Verify user is logged out await expect(page.getByRole('button', { name: /sign in|login/i })).toBeVisible() await expect(page.getByRole('button', { name: /sign out|logout/i })).not.toBeVisible() }) }) test.describe('Dashboard Access', () => { test('should allow authenticated user to access dashboard', async ({ page }) => { // Sign in await page.getByRole('button', { name: /sign in|login/i }).click() await page.getByLabel(/email/i).fill(TEST_USER.email) await page.getByLabel(/password/i).fill(TEST_USER.password) await page.getByRole('button', { name: /sign in|login/i }).click() await page.waitForURL('**/dashboard') // Access dashboard await page.getByText(/dashboard|home/i).click() // Verify dashboard content await expect(page.getByText(/league|standings/i)).toBeVisible() await expect(page.getByText(/matches|fixtures/i)).toBeVisible() }) test('should display real-time match data', async ({ page }) => { // Sign in await page.getByRole('button', { name: /sign in|login/i }).click() await page.getByLabel(/email/i).fill(TEST_USER.email) await page.getByLabel(/password/i).fill(TEST_USER.password) await page.getByRole('button', { name: /sign in|login/i }).click() await page.waitForURL('**/dashboard') // Check for match data sections await expect(page.getByText(/upcoming|live|finished/i)).toBeVisible() // Verify match cards are displayed (if data is available) const matchCards = page.locator('[data-testid*="match"], .match-card, [class*="match"]') await expect(matchCards.first()).toBeVisible() }) test('should allow navigation to league standings', async ({ page }) => { // Sign in and access dashboard await page.getByRole('button', { name: /sign in|login/i }).click() await page.getByLabel(/email/i).fill(TEST_USER.email) await page.getByLabel(/password/i).fill(TEST_USER.password) await page.getByRole('button', { name: /sign in|login/i }).click() await page.waitForURL('**/dashboard') // Navigate to league standings await page.getByText(/league|standings/i).click() // Verify league standings page await expect(page.getByText(/premier league|championship/i)).toBeVisible() await expect(page.locator('table, .standings-table, [class*="standings"]')).toBeVisible() }) }) test.describe('Admin Access Control', () => { test('should block non-admin users from admin pages', async ({ page }) => { // Sign in.getByRole('button', { name: /sign in|login/i }).click() await page.getByLabel(/email/i).fill(TEST_USER.email) await page.getByLabel(/password/i).fill(TEST_USER.password) await page.getByRole('button', { name: /sign in|login/i }).click() await page.waitForURL('**/dashboard') // Try to access admin pages directly await page.goto('/winmixpro/admin') // Should be redirected or see access denied message await expect(page.getByText(/access denied|unauthorized|forbidden/i)).toBeVisible() await expect(page.getByText(/admin/i)).not.toBeVisible() }) test('should allow admin users to access admin dashboard', async ({ page }) => { // Sign in.getByRole('button', { name: /sign in|login/i }).click() await page.getByLabel(/email/i).fill(ADMIN_USER.email) await page.getByLabel(/password/i).fill(ADMIN_USER.password) await page.getByRole('button', { name: /sign in|login/i }).click() await page.waitForURL('**/dashboard') // Navigate to admin dashboard await page.goto('/winmixpro/admin') // Should see admin content await expect(page.getByText(/admin dashboard|system/i)).toBeVisible() await expect(page.getByText(/feature management|theme/i)).toBeVisible() }) test('should show different UI for admin users', async ({ page }) => { // Sign in.getByRole('button', { name: /sign in|login/i }).click() await page.getByLabel(/email/i).fill(ADMIN_USER.email) await page.getByLabel(/password/i).fill(ADMIN_USER.password) await page.getByRole('button', { name: /sign in|login/i }).click() await page.waitForURL('**/dashboard') // Should see admin-specific navigation items await expect(page.getByText(/admin|management|settings/i)).toBeVisible() // Admin users should have access to admin features const adminNavItem = page.locator('[href*="admin"], [data-testid*="admin"], .admin-nav') await expect(adminNavItem.first()).toBeVisible() }) }) test.describe('Core Functionality', () => { test('should load and display league data', async ({ page }) => { // Sign in await page.getByRole('button', { name: /sign in|login/i }).click() await page.getByLabel(/email/i).fill(TEST_USER.email) await page.getByLabel(/password/i).fill(TEST_USER.password) await page.getByRole('button', { name: /sign in|login/i }).click() await page.waitForURL('**/dashboard') // Wait for data to load await page.waitForSelector('[data-testid*="league"], .league-card, [class*="league"]', { timeout: 10000 }) // Verify league data is displayed const leagueElements = page.locator('[data-testid*="league"], .league-card, [class*="league"]') const async count() { return await leagueElements.count() expect(count).toBeGreaterThan(0) }) test('should handle match schedule navigation', async ({ page }) => { // Sign in and access dashboard await page.getByRole('button', { name: /sign in|login/i }).click() await page.getByLabel(/email/i).fill(TEST_USER.email) await page.getByLabel(/password/i).fill(TEST_USER.password) await page.getByRole('button', { name: /sign in|login/i }).click() await page.waitForURL('**/dashboard') // Navigate to matches page await page.getByText(/matches|fixtures|calendar/i).click() // Verify matches page content await expect(page.getByText(/upcoming|live|finished/i)).toBeVisible() await expect(page.locator('[data-testid*="match"], .match-item, [class*="match"]')).toBeVisible() }) test('should responsive design work on mobile', async ({ page, context }) => { // Set mobile viewport await page.setViewportSize({ width: 375, height: 667 }) // Sign in await page.getByRole('button', { name: /sign in|login/i }).click() await page.getByLabel(/email/i).fill(TEST_USER.email) await page.getByLabel(/password/i).fill(TEST_USER.password) await page.getByRole('button', { name: /sign in|login/i }).click() await page.waitForURL('**/dashboard') // Verify mobile navigation works const mobileMenu = page.locator('[data-testid*="mobile"], .mobile-menu, .hamburger') await expect(mobileMenu.first()).toBeVisible() // Test mobile navigation await mobileMenu.first().click() await expect(page.getByText(/navigation|menu/i)).toBeVisible() }) }) test.describe('Error Handling', () => { test('should handle network errors gracefully', async ({ page }) => { // Sign in await page.getByRole('button', { name: /sign in|login/i }).click() await page.getByLabel(/email/i).fill(TEST_USER.email) await page.getByLabel(/password/i).fill(TEST_USER.password) await page.getByRole('button', { name: /sign in|login/i }).click() await page.waitForURL('**/dashboard') // Simulate network error by blocking requests await page.route('**/*', (route) => { if (route.request().url().includes('supabase')) { route.abort() } else { route.continue() } }) // Try to load data await page.reload() // Should show error state or loading state await expect(page.getByText(/error|failed|offline/i)).toBeVisible() }) test('should handle invalid routes', async ({ page }) => { await page.goto('/non-existent-route') // Should show 404 or redirect to home await expect(page.getByText(/404|not found|home/i)).toBeVisible() }) }) })