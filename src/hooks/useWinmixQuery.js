 import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query' import { winmixApi } from '../services/winmixApi' import { useMemo } from 'react' // Type definitions for API methods type WinmixApiMethod = keyof typeof winmixApi type WinmixApiReturnType = Awaited // Query key factory for consistent cache management export const winmixQueryKeys = { all: ['winmix']// Data types standings: (leagueId) => [...winmixQueryKeys.all, 'standings', leagueId]: () => [...winmixQueryKeys.all, 'liveMatches']: () => [...winmixQueryKeys.all, 'finishedMatches']: (playerId) => [...winmixQueryKeys.all, 'playerProfile', playerId]: (category?) => [...winmixQueryKeys.all, 'storeInventory', category]: (conversationId?) => [...winmixQueryKeys.all, 'chatMessages', conversationId]: (type?) => [...winmixQueryKeys.all, 'schedule', type]: () => [...winmixQueryKeys.all, 'predictions']: () => [...winmixQueryKeys.all, 'todos']: () => [...winmixQueryKeys.all, 'systemStatus']: (teamId) => [...winmixQueryKeys.all, 'teamAnalytics', teamId]// Generic hook for any WinMix API method export function useWinmixQuery< T extends WinmixApiMethod >( method? }, [method, params]) const queryFn: = useMemo(() => { return () => (winmixApi)[method](...params) }, [method, params]) const query = useQuery({ queryKey, queryFn, enabled?.enabled !== false, staleTime?.staleTime ?? getDefaultStaleTime(method), refetchInterval?.refetchInterval ?? getDefaultRefetchInterval(method), gcTime?.cacheTime ?? getDefaultCacheTime(method), retry: (failureCount, error) => { // Don't retry on 4xx errors if (error?.status >= 400 && error?.status < 500) return false return failureCount < 3 }, }) return query } // Specialized hooks for common data types // ===== LEAGUE STANDINGS ===== export function useLeagueStandings(leagueId?) } // ===== MATCHES ===== export function useLiveMatches(options?) } export function useFinishedMatches(limit = 50, options?) } // ===== PLAYER DATA ===== export function usePlayerProfile(playerId?) } // ===== STORE DATA ===== export function useStoreInventory(category??) } // ===== CHAT MESSAGES ===== export function useChatMessages(conversationId??) } // ===== SCHEDULE ===== export function useSchedule(type?: 'training' | 'match' | 'meeting' | 'event', options?) } // ===== PREDICTIONS ===== export function usePredictions(limit = 20, options?) } // ===== TODOS ===== export function useTodos(options?) } // ===== SYSTEM STATUS ===== export function useSystemStatus(options?) } // ===== TEAM ANALYTICS ===== export function useTeamAnalytics(teamId?) } // Memoized selector hooks for data transformations export function useLeagueStandingsSelector( standings'data'], selector: (data) => any ) { return useMemo(() => { return selector?.(standings) }, [standings, selector]) } export function useMatchSelector( matches'data'], selector: (data) => any ) { return useMemo(() => { return selector?.(matches) }, [matches, selector]) } export function usePlayerSelector( player'data'], selector: (data) => any ) { return useMemo(() => { return selector?.(player) }, [player, selector]) } // ===== MUTATION HOOKS ===== // Generic mutation hook export function useWinmixMutation< T extends (...args) => Promise( mutationFn?) }) } }, onError: (error) => { options?.onError?.(error) }, }) } // ===== HELPER FUNCTIONS ===== // Default stale times based on data type function getDefaultStaleTime(method)= { fetchLeagueStandings: 1000 * 60 * 10, // 10 minutes fetchLiveMatches: 1000 * 60 * 2, // 2 minutes fetchFinishedMatches: 1000 * 60 * 10, // 10 minutes fetchPlayerProfile: 1000 * 60 * 15, // 15 minutes fetchStoreInventory: 1000 * 60 * 5, // 5 minutes fetchChatMessages: 1000 * 30, // 30 seconds fetchSchedule: 1000 * 60 * 30, // 30 minutes fetchPredictions: 1000 * 60 * 5, // 5 minutes fetchTodos: 1000 * 60 * 2, // 2 minutes fetchSystemStatus: 1000 * 60, // 1 minute fetchTeamAnalytics: 1000 * 60 * 10, // 10 minutes } return staleTimes[method] ?? 1000 * 60 * 5 // Default 5 minutes } // Default refetch intervals for real-time data function getDefaultRefetchInterval(method)= { fetchLeagueStandings// No auto-refetch fetchLiveMatches: 30000, // 30 seconds fetchFinishedMatches// No auto-refetch fetchPlayerProfile// No auto-refetch fetchStoreInventory// No auto-refetch fetchChatMessages: 10000, // 10 seconds fetchSchedule// No auto-refetch fetchPredictions: 60000, // 1 minute fetchTodos// No auto-refetch fetchSystemStatus: 60000, // 1 minute fetchTeamAnalytics// No auto-refetch } return refetchIntervals[method] ?? false } // Default cache times for query client function getDefaultCacheTime(method)// 5 minutes default } // Utility for optimistic updates export function useOptimisticUpdate( queryKey: (oldData) => any ) { const queryClient = useQueryClient() const optimisticUpdate = async (data) => { // Cancel any outgoing refetches await queryClient.cancelQueries({ queryKey: }) // Snapshot the previous value const previousData = queryClient.getQueryData(queryKey) // Optimistically update to the new value queryClient.setQueryData(queryKey, (old) => updateFn(old)) // Return a context object with the snapshotted value return { previousData } } const rollback = async (context return { optimisticUpdate, rollback } } export default useWinmixQuery 