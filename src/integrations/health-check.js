import { supabase } from '@/integrations/supabase/client' avgResponseTime; p95ResponseTime; errorRate; requestsPerSecond?; activeUsers?; predictionsPerDay?; modelAccuracy?; systemUptime?; cacheHitRate?; memoryUsage?; cpuUsage?; timestamp; }; async function checkDatabaseHealth() { const start = performance.now(); try { // Lightweight ping using an RPC free endpoint (invoke a lightweight function if available) const { error } = await supabase.from("leagues").select("id").limit(1); const elapsed = Math.round(performance.now() - start); return { dbConnectionStatus? (elapsed > 500 ? "degraded" : "offline") , "healthy", dbResponseTime().toISOString(), }; } catch { const elapsed = Math.round(performance.now() - start); return { dbConnectionStatus? "degraded" : "offline", dbResponseTime().toISOString(), }; } } async function checkApiHealth() { const start = performance.now(); try { const { error } = await supabase.functions.invoke("monitoring-health"); const elapsed = Math.round(performance.now() - start); return { avgResponseTime? 1 : 0, timestamp().toISOString(), }; } catch { const elapsed = Math.round(performance.now() - start); return { avgResponseTime: 1, timestamp().toISOString(), }; } } async function checkCacheHealth() { // Placeholder values since app doesn't include a cache layer return { cacheHitRate: 0.9, memoryUsage: 0.65, cpuUsage: 0.35, timestamp().toISOString(), }; } export const healthCheck = async ()=> { const[db, api, cache] = await Promise.all([ checkDatabaseHealth(), checkApiHealth(), checkCacheHealth(), ]); return { dbConnectionStatus.dbConnectionStatus ?? "unknown", dbResponseTime.dbResponseTime ?? 0, dbConnectionCount.dbConnectionCount, dbQueryQueueLength.dbQueryQueueLength, avgResponseTime.avgResponseTime ?? 0, p95ResponseTime.p95ResponseTime ?? 0, errorRate.errorRate ?? 0, requestsPerSecond.requestsPerSecond, activeUsers.cacheHitRate, memoryUsage.memoryUsage, cpuUsage.cpuUsage, timestamp().toISOString(), }; }; export default healthCheck; 