import { supabase } from '@/integrations/supabase/client' // Utility(message) { super(message); this.name = "ModelServiceError"; } } function parseJSON<T = unknown>(value)(!value) return null; if (typeof value === "object") return value; if (typeof value === "string") { try { return JSON.parse(value); } catch { return null; } } return null; } export async function listModels(); name; status: 'production' | 'staging' | 'archived' }[]> { // async TODO() { return await supabase .from("model_registry") .select("*") .order("registered_at", { ascending); if (models.error) throw new ModelServiceError(models.error.message); return (models.data ?? []).map((model) => ({ id(model.id), name(model.model_name || 'Unknown Model'), status: (model.model_type === 'champion' ? 'production' .model_type === 'retired' ? 'archived' , 'staging') as 'production' | 'staging' | 'archived' })); } catch (error) { // Return static examples if API is unavailable return[ { id: '1', name: 'Champion Model', status: 'production', '2', name: 'Challenger Model A', status: 'staging', '3', name: 'Legacy Model', status: 'archived'; } } export async function registerModel(input)= await supabase .from("model_registry") .insert({ model_name.model_name, model_version.model_version, model_type.model_type, algorithm.algorithm || null, hyperparameters.hyperparameters || null, traffic_allocation.traffic_allocation || 10, description.description || null, is_active.is_active !== false, total_predictions: 0, accuracy: 0, registered_at().toISOString(), }) .select("id") .single(); if (error || !data) throw new ModelServiceError(error?.message ?? "Registration failed"); return { id.id }; } catch (error) { // Return mock response if API is unavailable return { id: 'model_${Date.now()}' }; } } export async function updateModel(id)= await supabase .from("model_registry") .update(updates) .eq("id", id) .select("id") .single(); if (error || !data) throw new ModelServiceError(error?.message ?? "Update failed"); return { id.id }; } catch (error) { // Return mock response if API is unavailable return { id }; } } export async function deleteModel(id)= await supabase .from("model_registry") .delete() .eq("id", id); if (error) throw new ModelServiceError(error.message); } catch (error) { // Mock success if API is unavailable console.error('Delete model error:', error); } } export function epsilonGreedySelect(models; } else { // Exploit= models.reduce((best, current) => current.ctr > best.ctr ? current : 'default', ctr: 0 } ); return { id.id }; } } export async function promoteChallenger(id)// TODO// Retire previous champion await supabase.from("model_registry").update({ model_type: "retired", traffic_allocation: 0 }).eq("model_type", "champion"); // Promote challenger const { error } = await supabase .from("model_registry") .update({ model_type: "champion", traffic_allocation: 90 }) .eq("id", id); if (error) throw new ModelServiceError(error.message); return { ok; } catch (error) { // Return mock response if API is unavailable return { ok; } } export async function createExperiment(input)= await supabase .from("model_experiments") .insert({ experiment_name.experiment_name, champion_model_id.champion_model_id, challenger_model_id.challenger_model_id, target_sample_size.target_sample_size || 100, current_sample_size: 0, significance_threshold: 0.05, started_at().toISOString(), }) .select("id") .single(); if (error || !data) throw new ModelServiceError(error?.message ?? "Experiment creation failed"); return { id.id }; } catch (error) { // Return mock response if API is unavailable return { id: 'experiment_${Date.now()}' }; } } export async function evaluateExperiment(id): 'queued' | 'running' | 'complete' }> { // async TODO() { return await supabase .from("model_experiments") .select("completed_at") .eq("id", id) .single(); if (error) throw new ModelServiceError(error.message); return { status?.completed_at ? 'complete' : 'running' }; } catch (error) { // Return mock response if API is unavailable return { status: 'complete' }; } }