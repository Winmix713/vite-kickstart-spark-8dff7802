import { supabase } from '@/integrations/supabase/client' type Team = Database['public']['Tables']['teams']['Row'] type League = Database['public']['Tables']['leagues']['Row'] // Get match statistics const { async data() { return await supabase .from('matches') .select('home_score, away_score, home_team_id, away_team_id') .or('home_team_id.eq.${id},away_team_id.eq.${id}') .eq('status', 'finished') if (matchesError) throw matchesError // Calculate stats let matches_played = 0 let wins = 0 let draws = 0 let losses = 0 let goals_scored = 0 let goals_conceded = 0 matches?.forEach(match => { matches_played++ const isHome = match.home_team_id === id const teamScore = isHome ? match.home_score || 0 .away_score || 0 const opponentScore = isHome ? match.away_score || 0 .home_score || 0 goals_scored += teamScore goals_conceded += opponentScore if (teamScore > opponentScore) { wins++ } else if (teamScore === opponentScore) { draws++ } else { losses++ } }) const points = wins * 3 + draws return { ...team, matches_played, wins, draws, losses, goals_scored, goals_conceded, points } }, async createTeam(teamData)= await supabase .from('teams') .insert(teamData) .select() .single() if (error) throw error return data }, async updateTeam(id)= await supabase .from('teams') .update({ ...teamData, updated_at().toISOString() }) .eq('id', id) .select() .single() if (error) throw error return data }, async deleteTeam(id)= await supabase .from('teams') .delete() .eq('id', id) if (error) throw error }, async getLeagueTable(leagueId)= await this.getTeamsByLeague(leagueId) const async teamsWithStats() { return await Promise.all( teams.map(team => this.getTeamWithStats(team.id)) ) // Filter out null values and sort by points, then by goal difference return teamsWithStats .filter((team)=> team !== null) .sort((a, b) => { if (a.points !== b.points) { return b.points - a.points } const goalDiffA = a.goals_scored - a.goals_conceded const goalDiffB = b.goals_scored - b.goals_conceded return goalDiffB - goalDiffA }) }, async getTeamsByCountry(country)= await supabase .from('teams') .select('*') .eq('country', country) .order('name', { ascending) if (error) throw error return data || [] }, async getAllCountries()= await supabase .from('teams') .select('country') .not('country', 'is', null) .order('country', { ascending) if (error) throw error // Extract unique countries const countries = [...new Set((data || []).map(team => team.country))] return countries } }