import { useCallback, useMemo, useState } from 'react' const resolveInitial = (value(() => T))=> typeof value === "function" ? (value as () => T)() ; export const usePersistentState = (key(() => T)) => { const safeInitial = useMemo(() => { if (typeof window === "undefined") { return resolveInitial(initialValue); } try { const stored = window.localStorage.getItem(key); if (stored) { return JSON.parse(stored); } } catch (error) { console.warn('[winmixpro] localStorage parse error for ${key}', error); } return resolveInitial(initialValue); }, [initialValue, key]); const[value, setValue] = useState(safeInitial); const updateValue = useCallback( (next((prev) => T)) => { setValue((prev) => { const resolved = typeof next === "function" ? (next as (prev) => T)(prev) ; if (typeof window !== "undefined") { try { window.localStorage.setItem(key, JSON.stringify(resolved)); } catch (error) { console.warn('[winmixpro] localStorage write error for ${key}', error); } } return resolved; }); }, [key], ); return[value, updateValue]; }; 